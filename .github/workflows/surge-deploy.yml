name: Surge
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: peaceiris/actions-mdbook@v1
      - run: |
          mdbook init --force docs;cp -varf `ls | grep -v docs` docs/src/
          mv -v docs/src/book.toml docs/
          cd docs/
          mdbook build
      - uses: dswistowski/surge-sh-action@v1
        with:
          domain: 'xfscripts.rauldipeas.tk'
          project: 'docs/book'
          login: ${{ secrets.SURGE_LOGIN }}
          token: ${{ secrets.SURGE_TOKEN }}
      - name: cympfh/mastodon-cli
        run: |
          sudo add-apt-repository -y ppa:libreoffice/ppa
          sudo apt install -y jq libreoffice-core-nogui
          sudo ln -sv /usr/lib/libreoffice/program/uri-encode /usr/local/bin/
          git clone https://github.com/cympfh/mastodon-cli
          cd mastodon-cli/bin
          wget -O mast-auth.zip http://my.opendesktop.org/s/z8inTWEmALDMmaA/download
          unzip mast-auth.zip -d ~/
          git clone https://github.com/rauldipeas/xfscripts
          cd xfscripts
          ../mast toot -f https://blog.rauldipeas.tk/images/covers/xfscripts.png "Acabei de fazer uma atualização no XFScripts, não deixe de conferir!
            `git log --oneline -1` https://github.com/rauldipeas/xfscripts/commit/`git log --pretty=format:'%h' -n 1`
            https://xfscripts.rauldipeas.tk #xubuntu #xfscripts"
      - name: botostore/delall_bot
        run: curl "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage?chat_id=${{ secrets.TELEGRAM_TO }}&text=/delall"
      - uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          photo: images/desktop.png
          format: markdown
          message: |
            Acabei de fazer uma atualização no XFScripts... Não deixe de conferir!
            https://github.com/rauldipeas/xfscripts/commit/{{ commit.sha }}
            https://xfscripts.rauldipeas.tk